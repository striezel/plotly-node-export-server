const assert = require('node:assert');
const http = require('node:http');
const { describe, it } = require('node:test');

describe('basic charts, part 4', () => {
  describe('pie charts', () => {
    it('Basic Pie Chart', () => {
      const options = {
        port: 3000,
        host: 'localhost',
        method: 'POST'
      };

      const req = http.request(options);
      // Data taken from https://plotly.com/javascript/pie-charts/#basic-pie-chart example.
      const payload = `{
                         "data": [
                           {
                             "values": [ 19, 26, 55 ],
                             "labels": [ "Residential", "Non-Residential", "Utility" ],
                             "type": "pie"
                           }
                         ],
                         "layout": {
                           "height": 400,
                           "width": 500
                         }
                       }`;
      req.write(payload);
      req.end();

      req.on('response', (response) => {
        assert.strictEqual(200, response.statusCode);
        let body = '';
        response.on('data', (chunk) => {
          body += chunk;
        });
        response.on('end', () => {
          assert.ok(body.startsWith('<svg'));
          assert.ok(body.endsWith('</svg>'));

          // Browser-based answer would be something like
          // <svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="500" height="400" style="" viewBox="0 0 500 400"><rect x="0" y="0" width="500" height="400" style="fill: rgb(255, 255, 255); fill-opacity: 1;"/><defs id="defs-ed958c"><g class="clips"/><g class="gradients"/><g class="patterns"/></defs><g class="bglayer"/><g class="layer-below"><g class="imagelayer"/><g class="shapelayer"/></g><g class="cartesianlayer"/><g class="polarlayer"/><g class="smithlayer"/><g class="ternarylayer"/><g class="geolayer"/><g class="funnelarealayer"/><g class="pielayer"><g class="trace" stroke-linejoin="round" style="opacity: 1;"><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M215,210l0,-110a110,110 0 1 1 -33.99186938124425,214.6162167924669Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(269.3228587327326,222.6038955772127)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">55%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M215,210l-109.78294012710987,6.906957148224474a110,110 0 0 1 109.78294012710987,-116.90695714822448Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(168.62174434827907,170.44791903225067)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0">26%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M215,210l-33.991869381244186,104.6162167924669a110,110 0 0 1 -75.79107074586568,-97.70925964424242Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(159.35825091434162,257.16016472470875)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">19%</text></g></g></g></g><g class="iciclelayer"/><g class="treemaplayer"/><g class="sunburstlayer"/><g class="glimages"/><defs id="topdefs-ed958c"><g class="clips"/><clipPath id="legended958c"><rect width="133" height="67" x="0" y="0"/></clipPath></defs><g class="layer-above"><g class="imagelayer"/><g class="shapelayer"/></g><g class="infolayer"><g class="legend" pointer-events="all" transform="translate(355.4,100)"><rect class="bg" shape-rendering="crispEdges" style="stroke: rgb(68, 68, 68); stroke-opacity: 1; fill: rgb(255, 255, 255); fill-opacity: 1; stroke-width: 0px;" width="133" height="67" x="0" y="0"/><g class="scrollbox" transform="" clip-path="url(#legended958c)"><g class="groups"><g class="traces" style="opacity: 1;" transform="translate(0,14.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Utility</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="127.35000610351562" height="19"/></g><g class="traces" style="opacity: 1;" transform="translate(0,33.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Non-Residential</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="127.35000610351562" height="19"/></g><g class="traces" style="opacity: 1;" transform="translate(0,52.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Residential</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="127.35000610351562" height="19"/></g></g></g><rect class="scrollbar" rx="20" ry="3" width="0" height="0" style="fill: rgb(128, 139, 164); fill-opacity: 1;" x="0" y="0"/></g><g class="g-gtitle"/></g></svg>

          // Current server response is something like
          // <svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="500" height="400" style="" viewBox="0 0 500 400"><rect x="0" y="0" width="500" height="400" style="fill: rgb(255, 255, 255); fill-opacity: 1;"/><defs id="defs-96ac50"><g class="clips"/><g class="gradients"/><g class="patterns"/></defs><g class="bglayer"/><g class="layer-below"><g class="imagelayer"/><g class="shapelayer"/></g><g class="cartesianlayer"/><g class="polarlayer"/><g class="smithlayer"/><g class="ternarylayer"/><g class="geolayer"/><g class="funnelarealayer"/><g class="pielayer"><g class="trace" stroke-linejoin="round" style="opacity: 1;"><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M250,210l0,-110a110,110 0 1 1 -33.99186938124425,214.6162167924669Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(304.3228587327326,218.6038955772127)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">55%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M250,210l-109.78294012710987,6.906957148224474a110,110 0 0 1 109.78294012710987,-116.90695714822448Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(203.62174434827907,166.44791903225067)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0">26%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M250,210l-33.991869381244186,104.6162167924669a110,110 0 0 1 -75.79107074586568,-97.70925964424242Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(194.35825091434162,253.16016472470875)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">19%</text></g></g></g></g><g class="iciclelayer"/><g class="treemaplayer"/><g class="sunburstlayer"/><g class="glimages"/><defs id="topdefs-96ac50"><g class="clips"/><clipPath id="legend96ac50"><rect width="45" height="67" x="0" y="0"/></clipPath></defs><g class="layer-above"><g class="imagelayer"/><g class="shapelayer"/></g><g class="infolayer"><g class="legend" pointer-events="all" transform="translate(426.8,100)"><rect class="bg" shape-rendering="crispEdges" style="stroke: rgb(68, 68, 68); stroke-opacity: 1; fill: rgb(255, 255, 255); fill-opacity: 1; stroke-width: 0px;" width="45" height="67" x="0" y="0"/><g class="scrollbox" transform="" clip-path="url(#legend96ac50)"><g class="groups"><g class="traces" style="opacity: 1;" transform="translate(0,14.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Utility</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="40" height="19"/></g><g class="traces" style="opacity: 1;" transform="translate(0,33.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Non-Residential</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="40" height="19"/></g><g class="traces" style="opacity: 1;" transform="translate(0,52.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Residential</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="40" height="19"/></g></g></g><rect class="scrollbar" rx="20" ry="3" width="0" height="0" style="fill: rgb(128, 139, 164); fill-opacity: 1;" x="0" y="0"/></g><g class="g-gtitle"/></g></svg>

          // Check partial matches, avoiding the random id bits.
          assert.ok(body.indexOf('<svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="500" height="400" style="" viewBox="0 0 500 400"><rect x="0" y="0" width="500" height="400" style="fill: rgb(255, 255, 255); fill-opacity: 1;"/><defs id="defs') >= 0);
          assert.ok(body.indexOf('<g class="clips"/><g class="gradients"/><g class="patterns"/></defs><g class="bglayer"/><g class="layer-below"><g class="imagelayer"/><g class="shapelayer"/></g><g class="cartesianlayer"/><g class="polarlayer"/><g class="smithlayer"/><g class="ternarylayer"/><g class="geolayer"/><g class="funnelarealayer"/><g class="pielayer"><g class="trace" stroke-linejoin="round" style="opacity: 1;"><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M250,210l0,-110a110,110 0 1 1 -33.99186938124425,214.6162167924669Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(304.3228587327326,218.6038955772127)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">55%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M250,210l-109.78294012710987,6.906957148224474a110,110 0 0 1 109.78294012710987,-116.90695714822448Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(203.62174434827907,166.44791903225067)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0">26%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M250,210l-33.991869381244186,104.6162167924669a110,110 0 0 1 -75.79107074586568,-97.70925964424242Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(194.35825091434162,253.16016472470875)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">19%</text></g></g></g></g><g class="iciclelayer"/><g class="treemaplayer"/><g class="sunburstlayer"/><g class="glimages"/><defs id="topdefs-') > 0);
          assert.ok(body.indexOf('"><g class="clips"/><clipPath id="legend') > 0);
          assert.ok(body.indexOf('<rect width="45" height="67" x="0" y="0"/></clipPath></defs><g class="layer-above"><g class="imagelayer"/><g class="shapelayer"/></g><g class="infolayer"><g class="legend" pointer-events="all" transform="translate(426.8,100)"><rect class="bg" shape-rendering="crispEdges" style="stroke: rgb(68, 68, 68); stroke-opacity: 1; fill: rgb(255, 255, 255); fill-opacity: 1; stroke-width: 0px;" width="45" height="67" x="0" y="0"/><g class="scrollbox" transform="" clip-path="url(#legend') > 0);
          assert.ok(body.indexOf('<g class="groups"><g class="traces" style="opacity: 1;" transform="translate(0,14.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Utility</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="40" height="19"/></g><g class="traces" style="opacity: 1;" transform="translate(0,33.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Non-Residential</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="40" height="19"/></g><g class="traces" style="opacity: 1;" transform="translate(0,52.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Residential</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="40" height="19"/></g></g></g><rect class="scrollbar" rx="20" ry="3" width="0" height="0" style="fill: rgb(128, 139, 164); fill-opacity: 1;" x="0" y="0"/></g><g class="g-gtitle"/></g></svg>') > 0);
        });
      });
    });

    // TODO: Pie Chart Subplots - https://plotly.com/javascript/pie-charts/#pie-chart-subplots

    it('Donut Chart', () => {
      const options = {
        port: 3000,
        host: 'localhost',
        method: 'POST'
      };

      const req = http.request(options);
      // Data taken from https://plotly.com/javascript/pie-charts/#donut-chart example.
      const payload = `{
                         "data": [
                           {
                             "values": [ 16, 15, 12, 6, 5, 4, 42 ],
                             "labels": [ "US", "China", "European Union", "Russian Federation", "Brazil", "India", "Rest of World" ],
                             "domain": {
                               "column": 0
                             },
                             "name": "GHG Emissions",
                             "hoverinfo": "label+percent+name",
                             "hole": 0.4,
                             "type": "pie"
                           },
                           {
                             "values": [ 27, 11, 25, 8, 1, 3, 25 ],
                             "labels": [ "US", "China", "European Union", "Russian Federation", "Brazil", "India", "Rest of World" ],
                             "text": "CO2",
                             "textposition": "inside",
                             "domain": {
                               "column": 1
                             },
                             "name": "CO2 Emissions",
                             "hoverinfo": "label+percent+name",
                             "hole": 0.4,
                             "type": "pie"
                           }
                         ],
                         "layout": {
                           "title": {
                             "text": "Global Emissions 1990-2011"
                           },
                           "annotations": [
                             {
                               "font": {
                                 "size": 20
                               },
                               "showarrow": false,
                               "text": "GHG",
                               "x": 0.17,
                               "y": 0.5
                             },
                             {
                               "font": {
                                 "size": 20
                               },
                               "showarrow": false,
                               "text": "CO2",
                               "x": 0.82,
                               "y": 0.5
                             }
                           ],
                           "height": 400,
                           "width": 600,
                           "showlegend": false,
                           "grid": {
                             "rows": 1,
                             "columns": 2
                           }
                         }
                       }`;
      req.write(payload);
      req.end();

      req.on('response', (response) => {
        assert.strictEqual(200, response.statusCode);
        let body = '';
        response.on('data', (chunk) => {
          body += chunk;
        });
        response.on('end', () => {
          assert.ok(body.startsWith('<svg'));
          assert.ok(body.endsWith('</svg>'));

          // Browser-based answer would be something like
          // <svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" style="" viewBox="0 0 600 400"><rect x="0" y="0" width="600" height="400" style="fill: rgb(255, 255, 255); fill-opacity: 1;"/><defs id="defs-1d1c5e"><g class="clips"/><g class="gradients"/><g class="patterns"/></defs><g class="bglayer"/><g class="layer-below"><g class="imagelayer"/><g class="shapelayer"/></g><g class="cartesianlayer"/><g class="polarlayer"/><g class="smithlayer"/><g class="ternarylayer"/><g class="geolayer"/><g class="funnelarealayer"/><g class="pielayer"><g class="trace" stroke-linejoin="round" style="opacity: 1;"><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M204.2920478888715,246.52815213656527a41.68421052631579,41.68421052631579 0 0 0 -20.081521573082025,-78.21236266288105l0,-62.52631578947368a104.21052631578947,104.21052631578947 0 0 1 50.20380393270506,195.5309066572026Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(254.8661190170675,195.85872717839533)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">42%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M184.21052631578948,168.31578947368422a41.68421052631579,41.68421052631579 0 0 0 -35.19514299987347,19.34869359877025l-52.7927144998102,-33.503275391318304a104.21052631578947,104.21052631578947 0 0 1 87.98785749968367,-48.37173399692562Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(149.06786356289592,150.0757337610108)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0">16%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M149.015383315916,187.66448307245446a41.68421052631579,41.68421052631579 0 0 0 -3.5618557803104807,37.68049828155949l-58.13549817027592,23.017472031020915a104.21052631578947,104.21052631578947 0 0 1 8.904639450776202,-94.2012457038987Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(111.58690089790166,207.1350461968705)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">15%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(214, 39, 40); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M145.45352753560553,225.34498135401395a41.68421052631579,41.68421052631579 0 0 0 21.008725152839876,22.3720199908854l-26.62241044101611,56.57550201734901a104.21052631578947,104.21052631578947 0 0 1 -52.52181288209969,-55.93004997721349Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(128.68473066932216,266.1421927972816)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">12%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(148, 103, 189); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M166.4622526884454,247.71700134489936a41.68421052631579,41.68421052631579 0 0 0 15.130900392227424,3.884954913794923l-3.9260598526749755,62.402934388041395a104.21052631578947,104.21052631578947 0 0 1 -37.82725098056856,-9.712387284487306Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(162.38445563529152,299.0077054118393)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">6%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(140, 86, 75); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M181.59315308067283,251.60195625869426a41.68421052631579,41.68421052631579 0 0 0 12.983814847462165,-1.227331857963958l15.549662418518272,60.561936601095454a104.21052631578947,104.21052631578947 0 0 1 -32.45953711865541,3.0683296449098947Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(192.69116793739383,303.71371871700404)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">5%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(227, 119, 194); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M194.576967928135,250.3746244007303a41.68421052631579,41.68421052631579 0 0 0 9.715079960736514,-3.8464722641650555l30.122282359623043,54.79222820484787a104.21052631578947,104.21052631578947 0 0 1 -24.287699901841282,9.616180660412638Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(214.1990603816822,296.6082786062774)rotate(68.39999999999998)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0">4%</text></g></g></g><g class="trace" stroke-linejoin="round" style="opacity: 1;"><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M457.14499176005614,215.22441689383837a41.684210526315795,41.684210526315795 0 0 0 -41.3555180758456,-46.90862742015417l0,-62.526315789473685a104.21052631578948,104.21052631578948 0 0 1 103.388795189614,117.27156855038541Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(470.5081022372535,165.75903971902204)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0">27%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(214, 39, 40); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M415.7894736842105,168.31578947368422a41.684210526315795,41.684210526315795 0 0 0 -41.684210526315795,41.6842105263158l-62.526315789473685,1.0054998462188653e-14a104.21052631578948,104.21052631578948 0 0 1 104.21052631578948,-104.2105263157895Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(364.2078948039708,162.41842111976027)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">25%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M374.10526315789474,210a41.684210526315795,41.684210526315795 0 0 0 41.68421052631581,41.68421052631579l2.010999692437731e-14,62.526315789473685a104.21052631578948,104.21052631578948 0 0 1 -104.21052631578951,-104.21052631578947Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(364.2078948039708,265.58157888023976)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">25%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M415.7894736842105,251.68421052631578a41.684210526315795,41.684210526315795 0 0 0 26.57051578320854,-9.565974301135531l39.85577367481282,48.17735433777039a104.21052631578948,104.21052631578948 0 0 1 -66.42628945802134,23.91493575283883Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(442.1576346349438,287.2403845818898)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">11%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(148, 103, 189); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M442.35998946741904,242.11823622518025a41.684210526315795,41.684210526315795 0 0 0 12.186482996975423,-16.773254871166355l58.13549817027595,23.017472031020855a104.21052631578948,104.21052631578948 0 0 1 -30.466207492438556,41.93313717791589Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(483.30690562970005,263.0541415700365)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">8%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(227, 119, 194); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M454.54647246439447,225.3449813540139a41.684210526315795,41.684210526315795 0 0 0 2.188869776506647,-7.534139188124825l61.418802835035926,11.71626324883362a104.21052631578948,104.21052631578948 0 0 1 -5.472174441266617,18.83534797031206Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(505.2144412165703,239.90113111722954)scale(0.9412742017746956)rotate(16.199999999999932)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0">3%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(140, 86, 75); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M456.73534224090116,217.81084216588908a41.684210526315795,41.684210526315795 0 0 0 0.4096495191549934,-2.5864252720507723l62.03327711376841,7.836625340757462a104.21052631578948,104.21052631578948 0 0 1 -1.0241237978874835,6.46606318012693Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(514.8062965761505,227.13389767971844)scale(0.3583268120310612)rotate(8.999999999999886)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">1%</text></g></g></g></g><g class="iciclelayer"/><g class="treemaplayer"/><g class="sunburstlayer"/><g class="glimages"/><defs id="topdefs-1d1c5e"><g class="clips"/></defs><g class="layer-above"><g class="imagelayer"/><g class="shapelayer"/></g><g class="infolayer"><g class="g-gtitle"><text class="gtitle" style="opacity: 1; font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 17px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="300" y="50" text-anchor="middle" dy="0em">Global Emissions 1990-2011</text></g><g class="annotation" data-index="0" style="opacity: 1;"><g class="annotation-text-g" transform="rotate(0,180.8,210)"><g class="cursor-pointer" transform="translate(155,195)"><rect class="bg" style="stroke-width: 1px; stroke: rgb(0, 0, 0); stroke-opacity: 0; fill: rgb(0, 0, 0); fill-opacity: 0;" x="0.5" y="0.5" width="51" height="29"/><text class="annotation-text" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 20px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" text-anchor="middle" x="25.783203125" y="22">GHG</text></g></g></g><g class="annotation" data-index="1" style="opacity: 1;"><g class="annotation-text-g" transform="rotate(0,417.29999999999995,210)"><g class="cursor-pointer" transform="translate(394,195)"><rect class="bg" style="stroke-width: 1px; stroke: rgb(0, 0, 0); stroke-opacity: 0; fill: rgb(0, 0, 0); fill-opacity: 0;" x="0.5" y="0.5" width="46" height="29"/><text class="annotation-text" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 20px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" text-anchor="middle" x="23.5830078125" y="22">CO2</text></g></g></g></g></svg>

          // Current server response is something like
          // <svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" style="" viewBox="0 0 600 400"><rect x="0" y="0" width="600" height="400" style="fill: rgb(255, 255, 255); fill-opacity: 1;"/><defs id="defs-c7c255"><g class="clips"/><g class="gradients"/><g class="patterns"/></defs><g class="bglayer"/><g class="layer-below"><g class="imagelayer"/><g class="shapelayer"/></g><g class="cartesianlayer"/><g class="polarlayer"/><g class="smithlayer"/><g class="ternarylayer"/><g class="geolayer"/><g class="funnelarealayer"/><g class="pielayer"><g class="trace" stroke-linejoin="round" style="opacity: 1;"><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M204.2920478888715,246.52815213656527a41.68421052631579,41.68421052631579 0 0 0 -20.081521573082025,-78.21236266288105l0,-62.52631578947368a104.21052631578947,104.21052631578947 0 0 1 50.20380393270506,195.5309066572026Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(254.8661190170675,191.85872717839533)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">42%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M184.21052631578948,168.31578947368422a41.68421052631579,41.68421052631579 0 0 0 -35.19514299987347,19.34869359877025l-52.7927144998102,-33.503275391318304a104.21052631578947,104.21052631578947 0 0 1 87.98785749968367,-48.37173399692562Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(149.06786356289592,146.0757337610108)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0">16%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M149.015383315916,187.66448307245446a41.68421052631579,41.68421052631579 0 0 0 -3.5618557803104864,37.68049828155949l-58.13549817027593,23.017472031020915a104.21052631578947,104.21052631578947 0 0 1 8.904639450776216,-94.2012457038987Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(111.58690089790166,203.1350461968705)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">15%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(214, 39, 40); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M145.45352753560553,225.34498135401395a41.68421052631579,41.68421052631579 0 0 0 21.008725152839883,22.3720199908854l-26.62241044101611,56.57550201734901a104.21052631578947,104.21052631578947 0 0 1 -52.5218128820997,-55.93004997721349Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(128.68473066932216,262.1421927972816)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">12%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(148, 103, 189); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M166.4622526884454,247.71700134489936a41.68421052631579,41.68421052631579 0 0 0 15.130900392227424,3.884954913794923l-3.9260598526749755,62.402934388041395a104.21052631578947,104.21052631578947 0 0 1 -37.82725098056856,-9.712387284487306Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(162.3842572710337,295.0077054118393)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">6%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(140, 86, 75); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M181.59315308067283,251.60195625869426a41.68421052631579,41.68421052631579 0 0 0 12.983814847462165,-1.227331857963958l15.549662418518272,60.561936601095454a104.21052631578947,104.21052631578947 0 0 1 -32.45953711865541,3.0683296449098947Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(192.69096957313602,299.71371871700404)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">5%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(227, 119, 194); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M194.576967928135,250.3746244007303a41.68421052631579,41.68421052631579 0 0 0 9.715079960736514,-3.8464722641650497l30.122282359623043,54.79222820484788a104.21052631578947,104.21052631578947 0 0 1 -24.287699901841282,9.616180660412624Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(218.30038720395345,296.1011601368682)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0">4%</text></g></g></g><g class="trace" stroke-linejoin="round" style="opacity: 1;"><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M457.14499176005614,215.22441689383837a41.684210526315795,41.684210526315795 0 0 0 -41.3555180758456,-46.90862742015417l0,-62.526315789473685a104.21052631578948,104.21052631578948 0 0 1 103.388795189614,117.27156855038541Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(470.5081022372535,161.75903971902204)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0">27%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(214, 39, 40); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M415.7894736842105,168.31578947368422a41.684210526315795,41.684210526315795 0 0 0 -41.684210526315795,41.6842105263158l-62.526315789473685,1.0054998462188655e-14a104.21052631578948,104.21052631578948 0 0 1 104.21052631578948,-104.2105263157895Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(364.2078948039708,158.41842111976027)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">25%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M374.10526315789474,210a41.684210526315795,41.684210526315795 0 0 0 41.68421052631581,41.68421052631579l2.010999692437731e-14,62.526315789473685a104.21052631578948,104.21052631578948 0 0 1 -104.21052631578951,-104.21052631578947Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(364.2078948039708,261.58157888023976)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">25%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M415.7894736842105,251.68421052631578a41.684210526315795,41.684210526315795 0 0 0 26.57051578320854,-9.565974301135531l39.85577367481282,48.17735433777039a104.21052631578948,104.21052631578948 0 0 1 -66.42628945802134,23.91493575283883Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(442.1576346349438,283.2403845818898)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">11%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(148, 103, 189); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M442.35998946741904,242.11823622518025a41.684210526315795,41.684210526315795 0 0 0 12.186482996975423,-16.773254871166355l58.13549817027595,23.017472031020855a104.21052631578948,104.21052631578948 0 0 1 -30.466207492438556,41.93313717791589Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(483.30670726544224,259.0541415700365)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">8%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(227, 119, 194); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M454.54647246439447,225.3449813540139a41.684210526315795,41.684210526315795 0 0 0 2.188869776506647,-7.534139188124825l61.418802835035926,11.71626324883362a104.21052631578948,104.21052631578948 0 0 1 -5.472174441266617,18.83534797031206Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(507.2545591642718,236.5730637852381)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0">3%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(140, 86, 75); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M456.73534224090116,217.81084216588908a41.684210526315795,41.684210526315795 0 0 0 0.4096495191549934,-2.5864252720507723l62.03327711376841,7.836625340757462a104.21052631578948,104.21052631578948 0 0 1 -1.0241237978874835,6.46606318012693Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(515.582423198703,225.80565045718745)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">1%</text></g></g></g></g><g class="iciclelayer"/><g class="treemaplayer"/><g class="sunburstlayer"/><g class="glimages"/><defs id="topdefs-c7c255"><g class="clips"/></defs><g class="layer-above"><g class="imagelayer"/><g class="shapelayer"/></g><g class="infolayer"><g class="g-gtitle"><text class="gtitle" style="opacity: 1; font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 17px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="300" y="50" text-anchor="middle" dy="0em">Global Emissions 1990-2011</text></g><g class="annotation" data-index="0" style="opacity: 1;"><g class="annotation-text-g" transform="rotate(0,156.8,210)"><g class="cursor-pointer" transform="translate(155,208)"><rect class="bg" style="stroke-width: 1px; stroke: rgb(0, 0, 0); stroke-opacity: 0; fill: rgb(0, 0, 0); fill-opacity: 0;" x="0.5" y="0.5" width="3" height="3"/><text class="annotation-text" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 20px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" text-anchor="middle" x="2" y="2">GHG</text></g></g></g><g class="annotation" data-index="1" style="opacity: 1;"><g class="annotation-text-g" transform="rotate(0,438.79999999999995,210)"><g class="cursor-pointer" transform="translate(437,208)"><rect class="bg" style="stroke-width: 1px; stroke: rgb(0, 0, 0); stroke-opacity: 0; fill: rgb(0, 0, 0); fill-opacity: 0;" x="0.5" y="0.5" width="3" height="3"/><text class="annotation-text" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 20px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" text-anchor="middle" x="2" y="2">CO2</text></g></g></g></g></svg>

          // Check partial matches, avoiding the random id bits.
          assert.ok(body.indexOf('<svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="600" height="400" style="" viewBox="0 0 600 400"><rect x="0" y="0" width="600" height="400" style="fill: rgb(255, 255, 255); fill-opacity: 1;"/><defs id="defs') >= 0);
          assert.ok(body.indexOf('<g class="clips"/><g class="gradients"/><g class="patterns"/></defs><g class="bglayer"/><g class="layer-below"><g class="imagelayer"/><g class="shapelayer"/></g><g class="cartesianlayer"/><g class="polarlayer"/><g class="smithlayer"/><g class="ternarylayer"/><g class="geolayer"/><g class="funnelarealayer"/><g class="pielayer"><g class="trace" stroke-linejoin="round" style="opacity: 1;"><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M204.2920478888715,246.52815213656527a41.68421052631579,41.68421052631579 0 0 0 -20.081521573082025,-78.21236266288105l0,-62.52631578947368a104.21052631578947,104.21052631578947 0 0 1 50.20380393270506,195.5309066572026Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(254.8661190170675,191.85872717839533)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">42%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M184.21052631578948,168.31578947368422a41.68421052631579,41.68421052631579 0 0 0 -35.19514299987347,19.34869359877025l-52.7927144998102,-33.503275391318304a104.21052631578947,104.21052631578947 0 0 1 87.98785749968367,-48.37173399692562Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(149.06786356289592,146.0757337610108)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0">16%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M149.015383315916,187.66448307245446a41.68421052631579,41.68421052631579 0 0 0 -3.5618557803104864,37.68049828155949l-58.13549817027593,23.017472031020915a104.21052631578947,104.21052631578947 0 0 1 8.904639450776216,-94.2012457038987Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(111.58690089790166,203.1350461968705)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">15%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(214, 39, 40); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M145.45352753560553,225.34498135401395a41.68421052631579,41.68421052631579 0 0 0 21.008725152839883,22.3720199908854l-26.62241044101611,56.57550201734901a104.21052631578947,104.21052631578947 0 0 1 -52.5218128820997,-55.93004997721349Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(128.68473066932216,262.1421927972816)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">12%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(148, 103, 189); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M166.4622526884454,247.71700134489936a41.68421052631579,41.68421052631579 0 0 0 15.130900392227424,3.884954913794923l-3.9260598526749755,62.402934388041395a104.21052631578947,104.21052631578947 0 0 1 -37.82725098056856,-9.712387284487306Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(162.3842572710337,295.0077054118393)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">6%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(140, 86, 75); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M181.59315308067283,251.60195625869426a41.68421052631579,41.68421052631579 0 0 0 12.983814847462165,-1.227331857963958l15.549662418518272,60.561936601095454a104.21052631578947,104.21052631578947 0 0 1 -32.45953711865541,3.0683296449098947Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(192.69096957313602,299.71371871700404)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">5%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(227, 119, 194); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M194.576967928135,250.3746244007303a41.68421052631579,41.68421052631579 0 0 0 9.715079960736514,-3.8464722641650497l30.122282359623043,54.79222820484788a104.21052631578947,104.21052631578947 0 0 1 -24.287699901841282,9.616180660412624Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(218.30038720395345,296.1011601368682)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0">4%</text></g></g></g><g class="trace" stroke-linejoin="round" style="opacity: 1;"><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M457.14499176005614,215.22441689383837a41.684210526315795,41.684210526315795 0 0 0 -41.3555180758456,-46.90862742015417l0,-62.526315789473685a104.21052631578948,104.21052631578948 0 0 1 103.388795189614,117.27156855038541Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(470.5081022372535,161.75903971902204)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0">27%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(214, 39, 40); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M415.7894736842105,168.31578947368422a41.684210526315795,41.684210526315795 0 0 0 -41.684210526315795,41.6842105263158l-62.526315789473685,1.0054998462188655e-14a104.21052631578948,104.21052631578948 0 0 1 104.21052631578948,-104.2105263157895Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(364.2078948039708,158.41842111976027)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">25%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M374.10526315789474,210a41.684210526315795,41.684210526315795 0 0 0 41.68421052631581,41.68421052631579l2.010999692437731e-14,62.526315789473685a104.21052631578948,104.21052631578948 0 0 1 -104.21052631578951,-104.21052631578947Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(364.2078948039708,261.58157888023976)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">25%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M415.7894736842105,251.68421052631578a41.684210526315795,41.684210526315795 0 0 0 26.57051578320854,-9.565974301135531l39.85577367481282,48.17735433777039a104.21052631578948,104.21052631578948 0 0 1 -66.42628945802134,23.91493575283883Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(442.1576346349438,283.2403845818898)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">11%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(148, 103, 189); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M442.35998946741904,242.11823622518025a41.684210526315795,41.684210526315795 0 0 0 12.186482996975423,-16.773254871166355l58.13549817027595,23.017472031020855a104.21052631578948,104.21052631578948 0 0 1 -30.466207492438556,41.93313717791589Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(483.30670726544224,259.0541415700365)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">8%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(227, 119, 194); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M454.54647246439447,225.3449813540139a41.684210526315795,41.684210526315795 0 0 0 2.188869776506647,-7.534139188124825l61.418802835035926,11.71626324883362a104.21052631578948,104.21052631578948 0 0 1 -5.472174441266617,18.83534797031206Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(507.2545591642718,236.5730637852381)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0">3%</text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(140, 86, 75); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M456.73534224090116,217.81084216588908a41.684210526315795,41.684210526315795 0 0 0 0.4096495191549934,-2.5864252720507723l62.03327711376841,7.836625340757462a104.21052631578948,104.21052631578948 0 0 1 -1.0241237978874835,6.46606318012693Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(515.582423198703,225.80565045718745)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0">1%</text></g></g></g></g><g class="iciclelayer"/><g class="treemaplayer"/><g class="sunburstlayer"/><g class="glimages"/><defs id="topdefs') > 0);
          assert.ok(body.indexOf('<g class="clips"/></defs><g class="layer-above"><g class="imagelayer"/><g class="shapelayer"/></g><g class="infolayer"><g class="g-gtitle"><text class="gtitle" style="opacity: 1; font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 17px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="300" y="50" text-anchor="middle" dy="0em">Global Emissions 1990-2011</text></g><g class="annotation" data-index="0" style="opacity: 1;"><g class="annotation-text-g" transform="rotate(0,156.8,210)"><g class="cursor-pointer" transform="translate(155,208)"><rect class="bg" style="stroke-width: 1px; stroke: rgb(0, 0, 0); stroke-opacity: 0; fill: rgb(0, 0, 0); fill-opacity: 0;" x="0.5" y="0.5" width="3" height="3"/><text class="annotation-text" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 20px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" text-anchor="middle" x="2" y="2">GHG</text></g></g></g><g class="annotation" data-index="1" style="opacity: 1;"><g class="annotation-text-g" transform="rotate(0,438.79999999999995,210)"><g class="cursor-pointer" transform="translate(437,208)"><rect class="bg" style="stroke-width: 1px; stroke: rgb(0, 0, 0); stroke-opacity: 0; fill: rgb(0, 0, 0); fill-opacity: 0;" x="0.5" y="0.5" width="3" height="3"/><text class="annotation-text" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 20px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" text-anchor="middle" x="2" y="2">CO2</text></g></g></g></g></svg>') > 0);
        });
      });
    });

    it('Automatically Adjust Margins', () => {
      const options = {
        port: 3000,
        host: 'localhost',
        method: 'POST'
      };

      const req = http.request(options);
      // Data taken from https://plotly.com/javascript/pie-charts/#automatically-adjust-margins example.
      const payload = `{
                         "data": [
                           {
                             "type": "pie",
                             "values": [ 2, 3, 4, 4 ],
                             "labels": [ "Wages", "Operating expenses", "Cost of sales", "Insurance" ],
                             "textinfo": "label+percent",
                             "textposition": "outside",
                             "automargin": true
                           }
                         ],
                         "layout": {
                           "height": 400,
                           "width": 400,
                           "margin": { "t": 0, "b": 0, "l": 0, "r": 0 },
                           "showlegend": false
                         }
                       }`;
      req.write(payload);
      req.end();

      req.on('response', (response) => {
        assert.strictEqual(200, response.statusCode);
        let body = '';
        response.on('data', (chunk) => {
          body += chunk;
        });
        response.on('end', () => {
          assert.ok(body.startsWith('<svg'));
          assert.ok(body.endsWith('</svg>'));

          // Browser-based answer would be something like
          // <svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="400" height="400" style="" viewBox="0 0 400 400"><rect x="0" y="0" width="400" height="400" style="fill: rgb(255, 255, 255); fill-opacity: 1;"/><defs id="defs-d17baf"><g class="clips"/><g class="gradients"/><g class="patterns"/></defs><g class="bglayer"/><g class="layer-below"><g class="imagelayer"/><g class="shapelayer"/></g><g class="cartesianlayer"/><g class="polarlayer"/><g class="smithlayer"/><g class="ternarylayer"/><g class="geolayer"/><g class="funnelarealayer"/><g class="pielayer"><g class="trace" stroke-linejoin="round" style="opacity: 1;"><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M192,194.5l0,-150a150,150 0 0 1 140.25243640281224,203.1907330563803Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(359.0519423718414,100.38064277280779)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Cost of sales</tspan><tspan class="line" dy="1.3em" x="0" y="0">30.8%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M192,194.5l-140.25243640281224,53.19073305638032a150,150 0 0 1 140.25243640281224,-203.1907330563803Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(33.28112647581483,100.38064277280779)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Insurance</tspan><tspan class="line" dy="1.3em" x="0" y="0">30.8%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M192,194.5l35.897349643133616,145.64127261390783a150,150 0 0 1 -176.14978604594586,-92.45053955752752Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(59.68755843415735,335.90431539724204)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Operating expenses</tspan><tspan class="line" dy="1.3em" x="0" y="0">23.1%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(214, 39, 40); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M192,194.5l140.2524364028122,53.19073305638039a150,150 0 0 1 -104.35508675967858,92.45053955752743Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(318.8393627864122,311.82518712186516)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Wages</tspan><tspan class="line" dy="1.3em" x="0" y="0">15.4%</tspan></text></g></g></g></g><g class="iciclelayer"/><g class="treemaplayer"/><g class="sunburstlayer"/><g class="glimages"/><defs id="topdefs-d17baf"><g class="clips"/></defs><g class="layer-above"><g class="imagelayer"/><g class="shapelayer"/></g><g class="infolayer"><g class="g-gtitle"/></g></svg>

          // Current server response is something like
          // <svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="400" height="400" style="" viewBox="0 0 400 400"><rect x="0" y="0" width="400" height="400" style="fill: rgb(255, 255, 255); fill-opacity: 1;"/><defs id="defs-60d107"><g class="clips"/><g class="gradients"/><g class="patterns"/></defs><g class="bglayer"/><g class="layer-below"><g class="imagelayer"/><g class="shapelayer"/></g><g class="cartesianlayer"/><g class="polarlayer"/><g class="smithlayer"/><g class="ternarylayer"/><g class="geolayer"/><g class="funnelarealayer"/><g class="pielayer"><g class="trace" stroke-linejoin="round" style="opacity: 1;"><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0;" d="M210,210l0,-185a185,185 0 0 1 172.97800489680174,250.60190410286907Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(362.25201519032646,104.90802185473615)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Cost of sales</tspan><tspan class="line" dy="1.3em" x="0" y="0">30.8%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0;" d="M210,210l-172.97800489680174,65.60190410286906a185,185 0 0 1 172.97800489680174,-250.60190410286907Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(57.74798480967357,104.90802185473615)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Insurance</tspan><tspan class="line" dy="1.3em" x="0" y="0">30.8%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0;" d="M210,210l44.27339789319812,179.62423622381965a185,185 0 0 1 -217.25140278999987,-114.0223321209506Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(124.0262131719028,373.8093647458438)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Operating expenses</tspan><tspan class="line" dy="1.3em" x="0" y="0">23.1%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(214, 39, 40); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0;" d="M210,210l172.97800489680174,65.60190410286914a185,185 0 0 1 -128.7046070036036,114.02233212095051Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(332.67769177454704,348.47448841165374)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Wages</tspan><tspan class="line" dy="1.3em" x="0" y="0">15.4%</tspan></text></g></g></g></g><g class="iciclelayer"/><g class="treemaplayer"/><g class="sunburstlayer"/><g class="glimages"/><defs id="topdefs-60d107"><g class="clips"/></defs><g class="layer-above"><g class="imagelayer"/><g class="shapelayer"/></g><g class="infolayer"><g class="g-gtitle"/></g></svg>

          // Check partial matches, avoiding the random id bits.
          assert.ok(body.indexOf('<svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="400" height="400" style="" viewBox="0 0 400 400"><rect x="0" y="0" width="400" height="400" style="fill: rgb(255, 255, 255); fill-opacity: 1;"/><defs id="defs') >= 0);
          assert.ok(body.indexOf('<g class="clips"/><g class="gradients"/><g class="patterns"/></defs><g class="bglayer"/><g class="layer-below"><g class="imagelayer"/><g class="shapelayer"/></g><g class="cartesianlayer"/><g class="polarlayer"/><g class="smithlayer"/><g class="ternarylayer"/><g class="geolayer"/><g class="funnelarealayer"/><g class="pielayer"><g class="trace" stroke-linejoin="round" style="opacity: 1;"><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0;" d="M210,210l0,-185a185,185 0 0 1 172.97800489680174,250.60190410286907Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(362.25201519032646,104.90802185473615)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Cost of sales</tspan><tspan class="line" dy="1.3em" x="0" y="0">30.8%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0;" d="M210,210l-172.97800489680174,65.60190410286906a185,185 0 0 1 172.97800489680174,-250.60190410286907Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(57.74798480967357,104.90802185473615)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Insurance</tspan><tspan class="line" dy="1.3em" x="0" y="0">30.8%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0;" d="M210,210l44.27339789319812,179.62423622381965a185,185 0 0 1 -217.25140278999987,-114.0223321209506Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(124.0262131719028,373.8093647458438)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Operating expenses</tspan><tspan class="line" dy="1.3em" x="0" y="0">23.1%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(214, 39, 40); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0; stroke-width: 0;" d="M210,210l172.97800489680174,65.60190410286914a185,185 0 0 1 -128.7046070036036,114.02233212095051Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(332.67769177454704,348.47448841165374)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Wages</tspan><tspan class="line" dy="1.3em" x="0" y="0">15.4%</tspan></text></g></g></g></g><g class="iciclelayer"/><g class="treemaplayer"/><g class="sunburstlayer"/><g class="glimages"/><defs id="topdefs') > 0);
          assert.ok(body.indexOf('<g class="clips"/></defs><g class="layer-above"><g class="imagelayer"/><g class="shapelayer"/></g><g class="infolayer"><g class="g-gtitle"/></g></svg>') > 0);
        });
      });
    });

    it('Control Text Orientation Inside Pie Chart Sectors', () => {
      const options = {
        port: 3000,
        host: 'localhost',
        method: 'POST'
      };

      const req = http.request(options);
      // Data taken from https://plotly.com/javascript/pie-charts/#control-text-orientation-inside-pie-chart-sectors example.
      // Note: The server cannot properly handle text when orientation is "radial", so we use "horizontal" instead.
      const payload = `{
                         "data": [
                           {
                             "type": "pie",
                             "values": [ 2, 3, 4, 4 ],
                             "labels": [ "Wages", "Operating expenses", "Cost of sales", "Insurance" ],
                             "textinfo": "label+percent",
                             "insidetextorientation": "horizontal"
                           }
                         ],
                         "layout": [
                           {
                             "height": 700,
                             "width": 700
                           }
                         ]
                       }`;
      req.write(payload);
      req.end();

      req.on('response', (response) => {
        assert.strictEqual(200, response.statusCode);
        let body = '';
        response.on('data', (chunk) => {
          body += chunk;
        });
        response.on('end', () => {
          assert.ok(body.startsWith('<svg'));
          assert.ok(body.endsWith('</svg>'));

          // Browser-based answer would be something like
          // <svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="700" height="700" style="" viewBox="0 0 700 700"><rect x="0" y="0" width="700" height="700" style="fill: rgb(255, 255, 255); fill-opacity: 1;"/><defs id="defs-6f2557"><g class="clips"/><g class="gradients"/><g class="patterns"/></defs><g class="bglayer"/><g class="layer-below"><g class="imagelayer"/><g class="shapelayer"/></g><g class="cartesianlayer"/><g class="polarlayer"/><g class="smithlayer"/><g class="ternarylayer"/><g class="geolayer"/><g class="funnelarealayer"/><g class="pielayer"><g class="trace" stroke-linejoin="round" style="opacity: 1;"><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M302,360l0,-222a222,222 0 0 1 207.5736058761621,300.7222849234429Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(452.46281558112287,356.19166564941406)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Cost of sales</tspan><tspan class="line" dy="1.3em" x="0" y="0">30.8%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M302,360l-207.5736058761621,78.72228492344287a222,222 0 0 1 207.5736058761621,-300.7222849234429Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(145.08666360023997,356.19166564941406)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Insurance</tspan><tspan class="line" dy="1.3em" x="0" y="0">30.8%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M302,360l53.12807747183775,215.54908346858358a222,222 0 0 1 -260.70168334799985,-136.82679854514072Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(240.2558931979241,469.4487215737482)rotate(-62.307692307692264)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Operating expenses</tspan><tspan class="line" dy="1.3em" x="0" y="0">23.1%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(214, 39, 40); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M302,360l207.57360587616208,78.72228492344297a222,222 0 0 1 -154.44552840432434,136.8267985451406Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(407.9449270290588,473.84406988164557)rotate(48.46153846153845)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Wages</tspan><tspan class="line" dy="1.3em" x="0" y="0">15.4%</tspan></text></g></g></g></g><g class="iciclelayer"/><g class="treemaplayer"/><g class="sunburstlayer"/><g class="glimages"/><defs id="topdefs-6f2557"><g class="clips"/><clipPath id="legend6f2557"><rect width="155" height="86" x="0" y="0"/></clipPath></defs><g class="layer-above"><g class="imagelayer"/><g class="shapelayer"/></g><g class="infolayer"><g class="legend" pointer-events="all" transform="translate(532.88,100)"><rect class="bg" shape-rendering="crispEdges" style="stroke: rgb(68, 68, 68); stroke-opacity: 1; fill: rgb(255, 255, 255); fill-opacity: 1; stroke-width: 0px;" width="155" height="86" x="0" y="0"/><g class="scrollbox" transform="" clip-path="url(#legend6f2557)"><g class="groups"><g class="traces" style="opacity: 1;" transform="translate(0,14.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Cost of sales</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="149.35000610351562" height="19"/></g><g class="traces" style="opacity: 1;" transform="translate(0,33.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Insurance</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="149.35000610351562" height="19"/></g><g class="traces" style="opacity: 1;" transform="translate(0,52.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Operating expenses</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="149.35000610351562" height="19"/></g><g class="traces" style="opacity: 1;" transform="translate(0,71.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Wages</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(214, 39, 40); fill-opacity: 1; stroke-width: 0px; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="149.35000610351562" height="19"/></g></g></g><rect class="scrollbar" rx="20" ry="3" width="0" height="0" style="fill: rgb(128, 139, 164); fill-opacity: 1;" x="0" y="0"/></g><g class="g-gtitle"/></g></svg>

          // Current server response is something like
          // <svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="700" height="450" style="" viewBox="0 0 700 450"><rect x="0" y="0" width="700" height="450" style="fill: rgb(255, 255, 255); fill-opacity: 1;"/><defs id="defs-5c83ac"><g class="clips"/><g class="gradients"/><g class="patterns"/></defs><g class="bglayer"/><g class="layer-below"><g class="imagelayer"/><g class="shapelayer"/></g><g class="cartesianlayer"/><g class="polarlayer"/><g class="smithlayer"/><g class="ternarylayer"/><g class="geolayer"/><g class="funnelarealayer"/><g class="pielayer"><g class="trace" stroke-linejoin="round" style="opacity: 1;"><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M350,235l0,-135a135,135 0 0 1 126.227192762531,182.87165975074228Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(410.9455870533331,192.93229866512726)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Cost of sales</tspan><tspan class="line" dy="1.3em" x="0" y="0">30.8%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M350,235l-126.227192762531,47.87165975074229a135,135 0 0 1 126.227192762531,-182.87165975074228Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(289.0544129466669,192.93229866512726)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Insurance</tspan><tspan class="line" dy="1.3em" x="0" y="0">30.8%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M350,235l32.30761467882025,131.07714535251705a135,135 0 0 1 -158.53480744135126,-83.20548560177477Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(312.27720913124296,306.8747729584935)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Operating expenses</tspan><tspan class="line" dy="1.3em" x="0" y="0">23.1%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(214, 39, 40); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M350,235l126.22719276253099,47.871659750742346a135,135 0 0 1 -93.91957808371075,83.20548560177471Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(411.1184151183977,303.9884293030623)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Wages</tspan><tspan class="line" dy="1.3em" x="0" y="0">15.4%</tspan></text></g></g></g></g><g class="iciclelayer"/><g class="treemaplayer"/><g class="sunburstlayer"/><g class="glimages"/><defs id="topdefs-5c83ac"><g class="clips"/><clipPath id="legend5c83ac"><rect width="45" height="86" x="0" y="0"/></clipPath></defs><g class="layer-above"><g class="imagelayer"/><g class="shapelayer"/></g><g class="infolayer"><g class="legend" pointer-events="all" transform="translate(630.8,100)"><rect class="bg" shape-rendering="crispEdges" style="stroke: rgb(68, 68, 68); stroke-opacity: 1; fill: rgb(255, 255, 255); fill-opacity: 1; stroke-width: 0px;" width="45" height="86" x="0" y="0"/><g class="scrollbox" transform="" clip-path="url(#legend5c83ac)"><g class="groups"><g class="traces" style="opacity: 1;" transform="translate(0,14.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Cost of sales</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="40" height="19"/></g><g class="traces" style="opacity: 1;" transform="translate(0,33.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Insurance</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="40" height="19"/></g><g class="traces" style="opacity: 1;" transform="translate(0,52.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Operating expenses</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="40" height="19"/></g><g class="traces" style="opacity: 1;" transform="translate(0,71.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Wages</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(214, 39, 40); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="40" height="19"/></g></g></g><rect class="scrollbar" rx="20" ry="3" width="0" height="0" style="fill: rgb(128, 139, 164); fill-opacity: 1;" x="0" y="0"/></g><g class="g-gtitle"/></g></svg>

          // Check partial matches, avoiding the random id bits.
          assert.ok(body.indexOf('<svg class="main-svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="700" height="450" style="" viewBox="0 0 700 450"><rect x="0" y="0" width="700" height="450" style="fill: rgb(255, 255, 255); fill-opacity: 1;"/><defs id="defs') >= 0);
          assert.ok(body.indexOf('<g class="clips"/><g class="gradients"/><g class="patterns"/></defs><g class="bglayer"/><g class="layer-below"><g class="imagelayer"/><g class="shapelayer"/></g><g class="cartesianlayer"/><g class="polarlayer"/><g class="smithlayer"/><g class="ternarylayer"/><g class="geolayer"/><g class="funnelarealayer"/><g class="pielayer"><g class="trace" stroke-linejoin="round" style="opacity: 1;"><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M350,235l0,-135a135,135 0 0 1 126.227192762531,182.87165975074228Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(410.9455870533331,192.93229866512726)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Cost of sales</tspan><tspan class="line" dy="1.3em" x="0" y="0">30.8%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M350,235l-126.227192762531,47.87165975074229a135,135 0 0 1 126.227192762531,-182.87165975074228Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(289.0544129466669,192.93229866512726)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Insurance</tspan><tspan class="line" dy="1.3em" x="0" y="0">30.8%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M350,235l32.30761467882025,131.07714535251705a135,135 0 0 1 -158.53480744135126,-83.20548560177477Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(312.27720913124296,306.8747729584935)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Operating expenses</tspan><tspan class="line" dy="1.3em" x="0" y="0">23.1%</tspan></text></g></g><g class="slice"><path class="surface" style="pointer-events: none; fill: rgb(214, 39, 40); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;" d="M350,235l126.22719276253099,47.871659750742346a135,135 0 0 1 -93.91957808371075,83.20548560177471Z"/><g class="slicetext"><text data-notex="1" class="slicetext" transform="translate(411.1184151183977,303.9884293030623)" text-anchor="middle" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(255, 255, 255); fill-opacity: 1; white-space: pre;" x="0" y="0"><tspan class="line" dy="0em" x="0" y="0">Wages</tspan><tspan class="line" dy="1.3em" x="0" y="0">15.4%</tspan></text></g></g></g></g><g class="iciclelayer"/><g class="treemaplayer"/><g class="sunburstlayer"/><g class="glimages"/><defs id="topdefs-') > 0);
          assert.ok(body.indexOf('"><g class="clips"/><clipPath id="legend') > 0);
          assert.ok(body.indexOf('"><rect width="45" height="86" x="0" y="0"/></clipPath></defs><g class="layer-above"><g class="imagelayer"/><g class="shapelayer"/></g><g class="infolayer"><g class="legend" pointer-events="all" transform="translate(630.8,100)"><rect class="bg" shape-rendering="crispEdges" style="stroke: rgb(68, 68, 68); stroke-opacity: 1; fill: rgb(255, 255, 255); fill-opacity: 1; stroke-width: 0px;" width="45" height="86" x="0" y="0"/><g class="scrollbox" transform="" clip-path="url(#legend') > 0);
          assert.ok(body.indexOf(')"><g class="groups"><g class="traces" style="opacity: 1;" transform="translate(0,14.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Cost of sales</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(31, 119, 180); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="40" height="19"/></g><g class="traces" style="opacity: 1;" transform="translate(0,33.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Insurance</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(255, 127, 14); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="40" height="19"/></g><g class="traces" style="opacity: 1;" transform="translate(0,52.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Operating expenses</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(44, 160, 44); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="40" height="19"/></g><g class="traces" style="opacity: 1;" transform="translate(0,71.5)"><text class="legendtext" text-anchor="start" style="font-family: TOBESTRIPPEDOpen SansTOBESTRIPPED, verdana, arial, sans-serif; font-size: 12px; fill: rgb(68, 68, 68); fill-opacity: 1; white-space: pre;" x="40" y="4.680000000000001">Wages</text><g class="layers" style="opacity: 1;"><g class="legendfill"/><g class="legendlines"/><g class="legendsymbols"><g class="legendpoints"><path class="legendpie" d="M6,6H-6V-6H6Z" transform="translate(20,0)" style="fill: rgb(214, 39, 40); fill-opacity: 1; stroke-width: 0; stroke: rgb(68, 68, 68); stroke-opacity: 1;"/></g></g></g><rect class="legendtoggle" style="fill: rgb(0, 0, 0); fill-opacity: 0;" x="0" y="-9.5" width="40" height="19"/></g></g></g><rect class="scrollbar" rx="20" ry="3" width="0" height="0" style="fill: rgb(128, 139, 164); fill-opacity: 1;" x="0" y="0"/></g><g class="g-gtitle"/></g></svg>') > 0);
        });
      });
    });

/*
    it('request with different data', () => {
      const options = {
        port: 3000,
        host: 'localhost',
        method: 'POST'
      };

      const req = http.request(options);
      const payload = '{ "x": ["2013-10-04 22:23:00", "2013-11-04 22:23:00", "2013-12-04 22:23:00"], "y": [1, 3, 6], "type": "scatter" }';
      req.write(payload);
      req.end();

      req.on('response', (response) => {
        assert.strictEqual(200, response.statusCode);
        let body = '';
        response.on('data', (chunk) => {
          body += chunk;
        });
        response.on('end', () => {
          assert.ok(body.startsWith('<svg'));
          assert.ok(body.endsWith('</svg>'));
          assert.ok(body.indexOf('width="700"') > 0);
          assert.ok(body.indexOf('height="400"') > 0);
        });
      });
    });
    */
  });
});
